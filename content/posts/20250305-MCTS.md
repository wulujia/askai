+++
date = '2025-03-05T10:35:20+08:00'
draft = false
title = 'Monte Carlo Tree Search'
+++

> 用尽可能浅显的语言和例子，帮助我理解 Monte Carlo Tree Search (MCTS)

**什么是蒙特卡洛树搜索（MCTS）？**  
蒙特卡洛树搜索，英文叫做 *Monte Carlo Tree Search*，是一种用来做决策或选择最佳动作的算法。它之所以叫“蒙特卡洛”，是因为算法会用到随机模拟（就像蒙特卡洛方法本身靠随机采样来解决问题），而“树搜索”是因为它会把每个选择（或动作）看作是树上的一个节点，然后在这个搜索树上不断探索和评估。

为了更好理解，先不纠结复杂的数学公式，我们从一个形象的例子说起。

---

## 一个简化的生活例子

想象你在一个游乐园里排了几个不同的项目队列，却只能选择一个项目去玩；你不知道哪个项目更好玩或者更值得等待。这个时候，你可能会先问问前面排队的人或者看别人在网上的评价——大致猜测一下这个项目的“好玩程度”。如果时间允许，你也可能去试着排一下队，体验一下，获取第一手的感受。然后再根据这个体验来判断：  
- 觉得还不错？那就更有动力继续排下去；  
- 感觉没什么意思？那就换一个项目去排队试试。

蒙特卡洛树搜索的“思路”类似：  
1. **先尝试**（随机模拟）不同的可能选择（行动）。  
2. **看看结果**（赢了还是输了，好还是坏）。  
3. **回头更新**对这些选择的看法，再去决定下一步该怎么做。  

---

## 在对战游戏中的简单例子

为了更好地说明，我们可以把它套用到一个小型的棋盘游戏上（比如井字棋/Tic-Tac-Toe）。当轮到你走棋时，你有几个可选的格子可以下子，每一个格子都可能带来不同的后续结果。你不知道该选哪个格子才是最优。MCTS 就是用以下几个步骤来帮你找到“更好”的落子点。

### 1. 选择（Selection）
- MCTS 会从当前的棋盘情况开始，根据之前累积的经验，在搜索树中挑选下一步要“重点探索”的节点。
- 一开始，大家都没下过棋，也没有经验。所以就会平均、随机地选择。
- 随着模拟的次数增多，MCTS 在选择下一个节点时，会使用一种方法平衡“探索”和“利用”。简单说就是：**既要尝试新的走法**（避免错过潜在的好选择），**又要多尝试那些似乎已经表现不错的走法**。

### 2. 拓展（Expansion）
- 当 MCTS 找到一个需要进一步探索的节点后，就会在这个节点下展开可能的新走法（新的孩子节点）。
- 在井字棋里，这就意味着如果某个格子还没有被探索过，就把这个落子对应的新局面“加进”搜索树里。

### 3. 模拟（Simulation）
- 接下来，MCTS 会在这个新局面开始，进行一次随机或简单规则的下法，直到终局（也就是某一方胜利或者棋盘填满）。
- 比如说，从你选择的格子开始，后续每一步都随机落子（当然，可能有一些基本策略），看看最后是谁赢。  
- 这种过程就类似我们上面说的“体验一下排队项目，感受好不好”，这里就“体验一下落子，看看最后是赢是输”。

### 4. 回传（Backpropagation）
- 一旦模拟结束，我们就知道了这条对局的结果（例如赢了+1，输了-1，平了就0分这样的简单打分）。
- MCTS 会把这次对局的结果“往回传”，更新搜索树上各个相关节点的统计数据。  
  - 比如说，每个节点上可能记录着：自己从被探索以来，总共模拟了多少次，赢了多少次，输或平了多少次。  
  - 这样做的好处是：当下次再进行“选择”时，就会考虑到已有的“胜率”信息。

### 不断循环
- 有了新的经验，就能更好地选下一次要“探索”的节点，接着再**拓展 - 模拟 - 回传**。  
- 重复很多次之后，每个节点都能积累相当多的模拟数据。  
- 直到时间（或计算资源）用完，MCTS 就会根据这些统计数据，挑选胜率最高或者最稳定的落子方案。

---

## 为什么有用？

1. **不用事先分析所有可能性**  
   比如在围棋这样复杂的游戏里，几乎不可能把所有的下法都预先计算穷尽。MCTS 只需要不断地进行随机模拟和数据更新，就能逐渐找出好的策略。

2. **逐渐聚焦到更优的选择**  
   - 随着模拟次数的增加，明显优势的落子会越来越被“利用”；  
   - 尚未被试过或者不太确定的落子也会被“探索”，防止错过潜在的好机会。  
   - 这个过程就是经典的“探索（exploration）和利用（exploitation）”平衡。

3. **自适应性**  
   如果我们时间很多，能进行大量模拟，就能得到更准确的结果；如果时间少，模拟次数就少一点，但也能给出一个大致还行的建议。

---

## 总结

- **MCTS核心**就是：  
  1. 随机地模拟未来的走法（就好像自己把后续的比赛快速打几遍）。  
  2. 看看模拟的结果。  
  3. 把结果更新回搜索树，让树上各个节点获得“这一步好不好”的信息。  
  4. 用这些信息来指导下次的选择。

- **它好比**：你要决定玩哪个游乐设施时，不断去试着排队、体验，然后把体验反馈为数据，下次就能做更好的决策。

- **MCTS 的魅力**在于，它不需要事先对整个棋盘（或问题）做“完全的”分析，只需要通过不断的模拟，就能一步步“挖掘”出不错的策略。  

这就是蒙特卡洛树搜索的直观思路。希望通过以上浅显的例子，你能对 MCTS 有一个初步的认识。实际应用中，还会有很多技术细节和数学上的公式去帮助它更好地平衡“探索”和“利用”，但核心逻辑就是这样：**不断模拟、不断更新、逐渐选择更优的策略**。